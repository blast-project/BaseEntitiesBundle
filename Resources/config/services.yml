services:

# ###################################################################################
#
#                             DOCTRINE BEHAVIORS
#
# ###################################################################################

# Service that manages Entity / Table naming convention
    librinfo.base_entities.listener.mapping:
        class: Librinfo\BaseEntitiesBundle\EventListener\MappingListener
        tags:
            - { name: doctrine.event_listener, event: loadClassMetadata }
        calls:
            - [setClassAnalyser, [Librinfo\CoreBundle\Tools\Reflection\ClassAnalyzer]]

# Service that manages Traceable doctrine mapping and behavior
    librinfo.base_entities.listener.traceable:
        class: Librinfo\BaseEntitiesBundle\EventListener\TraceableListener
        tags:
            - { name: doctrine.event_subscriber }
        calls:
            - [setLogger, [@logger]]
            - [setTokenStorage, [@security.token_storage]]
            - [setUserClass, [%librinfo.user_bundle.user.class%]]
            - [setClassAnalyser, [Librinfo\CoreBundle\Tools\Reflection\ClassAnalyzer]]

# Service that manages Addressable doctrine mapping
    librinfo.base_entities.listener.addressable:
        class: Librinfo\BaseEntitiesBundle\EventListener\AddressableListener
        tags:
            - { name: doctrine.event_subscriber }
        calls:
            - [setLogger, [@logger]]
            - [setClassAnalyser, [Librinfo\CoreBundle\Tools\Reflection\ClassAnalyzer]]

# Service that manages Treeable doctrine mapping
    librinfo.base_entities.listener.treeable:
        class: Librinfo\BaseEntitiesBundle\EventListener\TreeableListener
        tags:
            - { name: doctrine.event_subscriber }
        calls:
            - [setLogger, [@logger]]
            - [setClassAnalyser, [Librinfo\CoreBundle\Tools\Reflection\ClassAnalyzer]]

# Service that manages Nameable doctrine mapping
    librinfo.base_entities.listener.nameable:
        class: Librinfo\BaseEntitiesBundle\EventListener\NameableListener
        tags:
            - { name: doctrine.event_subscriber }
        calls:
            - [setLogger, [@logger]]
            - [setClassAnalyser, [Librinfo\CoreBundle\Tools\Reflection\ClassAnalyzer]]

# Service that manages Labelable doctrine mapping
    librinfo.base_entities.listener.labelable:
        class: Librinfo\BaseEntitiesBundle\EventListener\LabelableListener
        tags:
            - { name: doctrine.event_subscriber }
        calls:
            - [setLogger, [@logger]]
            - [setClassAnalyser, [Librinfo\CoreBundle\Tools\Reflection\ClassAnalyzer]]

# Service that manages Emailable doctrine mapping
    librinfo.base_entities.listener.emailable:
        class: Librinfo\BaseEntitiesBundle\EventListener\EmailableListener
        tags:
            - { name: doctrine.event_subscriber }
        calls:
            - [setLogger, [@logger]]
            - [setClassAnalyser, [Librinfo\CoreBundle\Tools\Reflection\ClassAnalyzer]]

# Service that manages Descriptible doctrine mapping
    librinfo.base_entities.listener.descriptible:
        class: Librinfo\BaseEntitiesBundle\EventListener\DescriptibleListener
        tags:
            - { name: doctrine.event_subscriber }
        calls:
            - [setLogger, [@logger]]
            - [setClassAnalyser, [Librinfo\CoreBundle\Tools\Reflection\ClassAnalyzer]]

# Service that manages Searchable doctrine mapping
    librinfo.base_entities.listener.searchable:
        class: Librinfo\BaseEntitiesBundle\EventListener\SearchableListener
        tags:
            - { name: doctrine.event_subscriber }
        calls:
            - [setLogger, [@logger]]
            - [setClassAnalyser, [Librinfo\CoreBundle\Tools\Reflection\ClassAnalyzer]]

# ###################################################################################
#
#                          SYMFONY CUSTOM FORM TYPES
#
# ###################################################################################

    librinfo_base_entities.form.type.librinfo_baseentities_treeable:
        class: Librinfo\BaseEntitiesBundle\Form\Type\TreeableType
        calls:
            - [setEntityManager, ['@doctrine.orm.entity_manager']]
        tags:
            - { name: form.type, alias: librinfo_baseentities_treeable }
    librinfo_base_entities.form.type.librinfo_baseentities_treeablechoice:
        class: Librinfo\BaseEntitiesBundle\Form\Type\TreeableChoiceType
        calls:
            - [setEntityManager, ['@doctrine.orm.entity_manager']]
        tags:
            - { name: form.type, alias: librinfo_baseentities_treeablechoice }

# ###################################################################################
#
#                          SEARCH ANALYZER
#
# ###################################################################################

    librinfo.base_entities.search_analyser:
        class: Librinfo\BaseEntitiesBundle\SearchAnalyser\SearchAnalyser